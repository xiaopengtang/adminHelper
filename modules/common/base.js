!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("jquery"),require("underscore"),require("backbone"),require("moment")):"function"==typeof define&&define.amd?define(["jquery","underscore","backbone","moment"],r):"object"==typeof exports?exports.app=r(require("jquery"),require("underscore"),require("backbone"),require("moment")):e.app=r(e.jquery,e.underscore,e.BackBone,e.moment)}(this,function(e,r,t,n){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=6)}([function(r,t){r.exports=e},function(e,t){e.exports=r},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function i(){this.emiter={}}function u(e){var r=f.default.Deferred(),t=e.actions,n=e.arg,o=[];Array.prototype.push.apply(o,t);var i=o.shift(),a=void 0;try{a=l.default.isFunction(i)?i.apply(!0,n):null}catch(e){r.reject(e)}!function(e,r){l.default.isObject(e)&&e.then&&e.always?e.always(function(e){return r()}):r()}(a,function(){return 0===o.length?r.resolve():u({actions:o,arg:n}).always(function(e){r[e instanceof Error||e instanceof TypeError?"reject":"resolve"](e)})});return r}Object.defineProperty(r,"__esModule",{value:!0});var a=t(1),l=n(a),c=t(0),f=n(c);i.prototype.on=function(e,r){return!this.emiter[e]&&(this.emiter[e]=[]),this.emiter[e].push(r)},i.prototype.emit=function(){var e=Array.prototype.slice.call(arguments),r=e[0],t=e.slice(1),n=f.default.Deferred(),i=this.emiter[r];return Array.isArray(i)&&i.length>0?u({actions:i,arg:[].concat(o(t))}):(n.resolve(),n)},r.default=i},function(e,r,t){"use strict";function n(){this.e=null}Object.defineProperty(r,"__esModule",{value:!0});var o=t(7),i=function(e){return e&&e.__esModule?e:{default:e}}(o);n.prototype.setError=function(e){this.e=e},n.prototype.getError=function(){return this.e},n.prototype.showError=function(){var e=this.e;console.group("BASE ERROR: "+e.message+"  "+(0,i.default)().format("YYYY-MM-DD hh:mm:ss")),console.log(e.stack),console.groupEnd()},n.prototype.vension="1.0.0",r.default=n},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.isError=function(e){return e instanceof Error||e instanceof TypeError}},function(e,r){e.exports=t},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,r){var t={};for(var n in e)r.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}Object.defineProperty(r,"__esModule",{value:!0}),r.register=r.use=r.error=r.middleware=r.init=r.extend=r.config=r.emiter=void 0;var i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},u=t(5),a=(n(u),t(1)),l=n(a),c=t(0),f=n(c),s=t(3),d=n(s),p=t(2),y=n(p),m=t(4),v=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(m),h=top._BASE_STATE_?{}:new d.default;h.utils=v;var E={extend:[],layout:{Home:[]},defaultTheme:"Home",configFile:"",loader:{paths:""}},w=r.emiter=y.default,_=new y.default,j=r.config=function(){var e=Array.prototype.slice.call(arguments),r=e[0],t=e[1];if("object"===f.default.type(r))return E=f.default.extend(!0,E,r);if(l.default.isString(r)&&void 0===t){var n=new Function("data","return data."+r),o=null;try{o=n(E)}catch(e){console.warn(e)}return o}if(l.default.isString(r)&&void 0!==t){var i=new Function("data","return data."+r+"="+t),u=null;try{u=i(E)}catch(e){console.warn(e)}return u}};h.config=j;var g=r.extend=function(e){return _.on("extend",e)},A=r.init=function e(){if("undefined"==typeof requirejs)throw new Error("请先引入requirejs");if(e.INSTALL)return console.warn("该框架已被实例化，请检测");e.INSTALL=!0;var r=f.default.Deferred();return function(e){j("configFile")?requirejs([j("configFile")],function(r){j(r),j("loader")&&requirejs(j("loader")),e()}):e()}(function(){return h.loader=requirejs,top.requirejs=requirejs,function(e){j("extend")?requirejs(j("extend"),function(){var r=Array.prototype.slice.apply(arguments);l.default.each(r,function(e){return _.on("extend",e)}),e()}):e()}(function(){return _.emit("extend",h).always(function(e){v.isError(e)&&(h.setError(e),_.emit("error",h)),top._BASE_STATE_=l.default.clone(E),top._BASE_STATE_.$app=h,r.resolve()})})}),r},b=r.middleware=function(e){return _.on("middleware",e)},x=r.error=function(e){return _.on("error",e)},q=r.use=function(e){return _.on("use",e)},O=function(e,r){if(top._BASE_STATE_){var t=top._BASE_STATE_||{},n=o(t,["$app"]);j(i({},n))}h.getError()||_.emit("use",h).always(function(t){if(v.isError(t))return h.setError(t),_.emit("error",h);var n=[],u=j("defaultTheme"),a=null;"object"===f.default.type(e)?(n=e.loaders,u=e.theme||u,a=e.middleware):Array.isArray(e)&&(n=e),l.default.isFunction(a)&&_.on("middleware",a);var c=l.default.clone(h),s=!1;c.next=function(e){if(e instanceof Error)return h.setError(e),_.emit("error",h);s=!0};var d=j("layout."+u)||[],p=[];Array.isArray(d)?p=d:"object"===f.default.type(d)&&(p=d.loaders,f.default.isFunction(d.middleware)&&_.on("middleware",d.middleware)),_.emit("middleware",c).always(function(e){if(v.isError(e))return h.setError(e),_.emit("error",h);if(!1!==s)return function(e,r){p.length>0?h.loader(p,function(){e.apply({scopeFun:r},arguments)}):e.call({scopeFun:r})}(function(){var e=this.scopeFun,r=Array.prototype.slice.apply(arguments);r.unshift(h),n.length>0?requirejs(n,function(){var t=Array.prototype.slice.apply(arguments);Array.prototype.push.apply(r,t),e.apply(this,r)}):e.apply(this,r)},function(){var t=Array.prototype.slice.apply(arguments);return function(n){var o=null;try{o=l.default.isFunction(r)&&r.apply(this,t)||{}}catch(e){h.setError(e),_.emit("error",h).always(function(){return h.setError(null)})}if(null!==o){return o.then&&o.always?o.always(function(r){if(v.isError(r))return h.setError(e),void _.emit("error",h).always(function(){return h.setError(null)});n(r)}):n(o)}}(function(e){var r=e||{},t=r.$id,n=o(r,["$id"]);!h.modules&&(h.modules={}),t&&(h.modules[t]=i({},n))})})})})};r.register=O,r.default={register:O,init:A,config:j,emiter:w,extend:g,error:x,middleware:b,use:q}},function(e,r){e.exports=n}])});